"use strict";const e=require("../common/vendor.js"),t=require("../stores/location.js"),o={userInfo:{apiName:["getUserInfo"],authTitle:"需要使用你的用户信息",authContent:"需要使用你的用户信息，请确认授权"},userLocation:{apiName:["getLocation","startLocationUpdate"],authTitle:"请求授权当前位置",authContent:"您未开启地理位置权限，搜苗无法为您推荐附近门诊，无法提供取号、核销等服务。您确定暂不开启吗？"},address:{apiName:["chooseAddress"],authTitle:"需要使用你的通讯地址",authContent:"需要使用你的通讯地址，请确认授权"},invoiceTitle:{apiName:["chooseInvoiceTitle"],authTitle:"需要使用你的发票抬头",authContent:"需要使用你的发票抬头，请确认授权"},invoice:{apiName:["chooseInvoice"],authTitle:"需要获取你的发票",authContent:"需要获取你的发票，请确认授权"},werun:{apiName:["getWeRunData"],authTitle:"需要获取你的微信运动数据",authContent:"需要获取你的微信运动数据，请确认授权"},writePhotosAlbum:{apiName:["saveImageToPhotosAlbum","saveVideoToPhotosAlbum"],authTitle:"请求授权相册",authContent:"需要使用你的相册，请确认授权"}};exports.getLocationInfo=async()=>{const n=t.useLocationStore();if(console.log("location",n.location),n.location)return console.log("获取上次定位",n.location),n.location;try{await new Promise(((t,n)=>{var a;(a="userLocation","string"!=typeof a||o[a]?new Promise(((t,o)=>{e.index.getSetting({success:async n=>{var i=n.authSetting;!1!==i[`scope.${a}`]&&i[`scope.${a}`]?t():e.index.authorize({scope:`scope.${a}`,success(e){t(e)},fail(e){o(e)}})}})})):Promise.reject()).then((()=>t())).catch((()=>function(t){return new Promise(((o,n)=>{e.index.showModal({title:"请开启定位",content:"为了方便展示您的地理位置",confirmText:"开启定位",success(a){a.confirm&&e.index.openSetting({success:async e=>{var a=e.authSetting;console.log("openSetting success",a),!1!==a[`scope.${t}`]&&a[`scope.${t}`]?o():n()},fail(e){console.log("openSetting fail",e),n()}}),a.cancel&&n()},fail(){n()}})}))}("userLocation").then((()=>t())).catch((()=>n()))))}));const t=await e.index.getLocation({type:"gcj02"}).then((e=>e)).catch((e=>e));return n.location=t,t}catch(a){return console.log("err",a),Promise.reject()}};
