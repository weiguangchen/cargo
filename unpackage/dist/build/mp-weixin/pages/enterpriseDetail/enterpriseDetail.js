"use strict";const e=require("../../common/vendor.js"),t=require("../../api/index.js"),a=require("../../utils/index.js"),o=require("../../stores/location.js"),n=require("../../utils/authorize.js");if(!Array){(e.resolveComponent("uv-navbar")+e.resolveComponent("uv-image")+e.resolveComponent("uv-sticky")+e.resolveComponent("my-price")+e.resolveComponent("my-drawer"))()}Math||((()=>"../../uni_modules/uv-navbar/components/uv-navbar/uv-navbar.js")+(()=>"../../uni_modules/uv-image/components/uv-image/uv-image.js")+(()=>"../../uni_modules/uv-sticky/components/uv-sticky/uv-sticky.js")+(()=>"../../components/my-price/my-price.js")+(()=>"../../components/my-drawer/my-drawer.js"))();const i={__name:"enterpriseDetail",setup(i){const u=o.useLocationStore(),{ctx:l}=e.getCurrentInstance(),r=e.computed((()=>{if(!u.location||!c.value.Latitude||!c.value.Logitude)return null;return a.gcj02Distance({lat1:c.value.Latitude,lon1:c.value.Logitude,lat2:u.location.latitude,lon2:u.location.longitude})})),c=e.ref({});function s(){e.index.navigateBack()}e.onLoad((a=>{n.getLocationInfo();e.getCurrentInstance().proxy.getOpenerEventChannel().on("setData",(a=>{console.log("setData",a),c.value=(null==a?void 0:a.supply)??{},a.supply&&async function(){L.value=!1;const a=await t.GetSupplyMaterialByOwner({supplyId:c.value.Id});b.value=a,L.value=!0,await e.nextTick$1(),async function(){(await l.$uv.getRect(".category-item",!0)).forEach(((t,a)=>{e.unref(b)[a].bottom=t.bottom-e.unref(m)-44,e.unref(b)[a].top=t.top-e.unref(m)-44}))}()}()}))}));const v=e.ref(!1),p=e.ref();function d(){p.value.popup.open()}const g=e.ref(1),m=e.ref(64);e.onReady((async()=>{let e=await l.$uv.getRect(".categorys-list");g.value=e.top;const t=l.$uv.sys().statusBarHeight;m.value=t+44}));const f=e.ref(1);e.onPageScroll((e=>{f.value=e.scrollTop}));const h=e.computed((()=>{const t=e.unref(f)/e.unref(g);return t>=1?1:t})),y=e.ref(0);e.onMounted((()=>{let t=e.index.getMenuButtonBoundingClientRect();y.value=t.width+20}));const x=e.ref(0),w=e.computed((()=>`category-${x.value}`)),b=e.ref([]),L=e.ref(!1);function C(){c.value.LinkerMobile?e.index.makePhoneCall({phoneNumber:c.value.LinkerMobile}):e.index.showToast({title:"暂无联系人电话",icon:"none"})}function j(){c.value.Latitude&&0!==c.value.Latitude&&c.value.Logitude&&0!==c.value.Logitude?e.index.openLocation({longitude:c.value.Logitude,latitude:c.value.Latitude,name:c.value.Name}):e.index.showToast({title:"暂无定位",icon:"none"})}return e.watchEffect((()=>{if(!L.value)return;const t=e.unref(b).findIndex((t=>e.unref(f)<t.bottom));x.value=t})),(t,a)=>e.e({a:"overflow:"+(v.value?"hidden":"visible"),b:e.o(s),c:e.p({title:c.value.Name,bgColor:`rgba(255,255,255,${h.value})`,titleStyle:{color:`rgba(26, 27, 28, ${h.value})`,paddingRight:`${y.value}px`,fontWeight:500}}),d:c.value},c.value?{e:e.p({width:"100%",height:"100%",src:c.value.Photo,mode:"aspectFill"})}:{},{f:e.t(c.value.Name),g:e.t("1"===c.value.Signed?"已签约":"未签约"),h:"1"===c.value.Signed?1:"",i:c.value.Balance},c.value.Balance?{j:e.t(c.value.Balance)}:{},{k:c.value.Notice},c.value.Notice?{l:e.p({src:"/static/images/enterpriseDetail/notice.png",width:"72rpx",height:"40rpx"}),m:e.t(c.value.Notice),n:e.p({src:"/static/images/enterpriseDetail/arrow.png",width:"32rpx",height:"32rpx"}),o:e.o(d)}:{},{p:r.value},r.value?{q:e.t(r.value)}:{},{r:e.t(c.value.Province||""),s:e.t(c.value.City||""),t:e.t(c.value.Address||""),v:e.p({src:"/static/images/enterpriseDetail/phone.png",width:"48rpx",height:"48rpx"}),w:e.o(C),x:e.p({src:"/static/images/enterpriseDetail/location.png",width:"48rpx",height:"48rpx"}),y:e.o(j),z:e.f(b.value,((t,a,o)=>({a:e.t(t.typeName),b:x.value===a?1:"",c:`category-${a}`,d:e.o((a=>function(t,a){e.index.pageScrollTo({scrollTop:t.top})}(t)))}))),A:w.value,B:e.p({index:"cate",customNavHeight:e.unref(l).$uv.addUnit(m.value)}),C:e.f(b.value,((t,a,o)=>({a:e.t(t.typeName),b:e.f(t.materialList,((a,n,i)=>({a:"5aa14b16-7-"+o+"-"+i,b:e.p({width:"100%",height:"100%",duration:0,src:a.Image,mode:"aspectFill"}),c:e.t(a.MaterialName),d:"5aa14b16-8-"+o+"-"+i,e:e.p({price:a.TaxPrice,color:"var(--red-color)",unit:"吨"}),f:n<t.materialList.length-1?1:"",g:a.MaterialId}))),c:t.typeId}))),D:e.t(c.value.Notice),E:e.sr(p,"5aa14b16-9",{k:"noticeDrawer"}),F:e.o((e=>v.value=e.show)),G:e.p({title:"生产企业公告",closeable:!0})})},__runtimeHooks:1};wx.createPage(i);
