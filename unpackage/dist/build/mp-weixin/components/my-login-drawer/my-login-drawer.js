"use strict";const e=require("../../common/vendor.js"),s=require("../../stores/user.js"),n=require("../../api/index.js"),o=require("../../utils/token.js");Math||(c+r)();const c=()=>"./login-drawer.js",r=()=>"./nickname-modal.js",a={__name:"my-login-drawer",emits:["success"],setup(c,{expose:r,emit:a}){const i=s.useUserStore(),t=a,u=e.ref(),l=e.ref();async function m(e){console.log("loginSuccess",e);const s=await i.login({mobile:e});console.log("登陆成功",s),s.Nickname?t("success"):l.value.open()}async function k(e){console.log("nicknameSuccess",e);try{await n.UptOwnerUserNickName({nickName:e}),l.value.close();const s=o.getToken();o.setToken({...s,userInfo:{...s.userInfo,Nickname:e}}),t("success")}catch(s){console.log("err",s),l.value.closeLoading()}}return r({open:function(){u.value.open()}}),(s,n)=>({a:e.sr(u,"7dec6aba-0",{k:"loginRef"}),b:e.o(m),c:e.sr(l,"7dec6aba-1",{k:"nicknameRef"}),d:e.o(k)})}};wx.createComponent(a);
