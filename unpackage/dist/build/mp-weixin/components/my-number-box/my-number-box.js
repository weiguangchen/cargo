"use strict";const t=require("../../uni_modules/uv-ui-tools/libs/mixin/mpMixin.js"),e=require("../../uni_modules/uv-ui-tools/libs/mixin/mixin.js"),i=require("../../uni_modules/uv-number-box/components/uv-number-box/props.js"),s=require("../../common/vendor.js"),n={name:"uv-number-box",mixins:[t.mpMixin,e.mixin,i.props],props:{unit:{default:"吨",type:String}},data:()=>({currentValue:"",longPressTimer:null}),watch:{watchChange(t){this.check()},value(t){t!==this.currentValue&&(this.currentValue=this.format(this.value))},modelValue(t){t!==this.currentValue&&(this.currentValue=this.format(this.modelValue))}},computed:{getCursorSpacing(){return this.$uv.getPx(this.cursorSpacing)},buttonStyle(){return t=>{const e={color:this.color};return this.isDisabled(t)&&(e.backgroundColor="#f7f8fa"),e}},inputStyle(){this.disabled||this.disabledInput;return{color:this.color}},watchChange(){return[this.integer,this.decimalLength,this.min,this.max]},isDisabled(){return t=>"plus"===t?this.disabled||this.disablePlus||this.currentValue>=this.max:this.disabled||this.disableMinus||this.currentValue<=this.min}},created(){this.init()},methods:{init(){const t=this.value||this.modelValue;this.currentValue=this.format(t)},format(t){return t=""===(t=this.filter(t))?0:+t,t=Math.max(Math.min(this.max,t),this.min),null!==this.decimalLength&&(t=t.toFixed(this.decimalLength)),t},filter(t){return t=String(t).replace(/[^0-9.-]/g,""),this.integer&&-1!==t.indexOf(".")&&(t=t.split(".")[0]),t},check(){const t=this.format(this.currentValue);t!==this.currentValue&&(this.currentValue=t)},onFocus(t){this.$emit("focus",{...t.detail,name:this.name})},onBlur(t){this.format(t.detail.value),this.$emit("blur",{...t.detail,name:this.name})},onInput(t){const{value:e=""}=t.detail||{};if(""===e)return;let i=this.filter(e);if(null!==this.decimalLength&&-1!==i.indexOf(".")){const t=i.split(".");i=`${t[0]}.${t[1].slice(0,this.decimalLength)}`}i=this.format(i),this.emitChange(i)},emitChange(t){this.asyncChange||this.$nextTick((()=>{this.$emit("input",t),this.$emit("update:modelValue",t),this.currentValue=t,this.$forceUpdate()})),this.$emit("change",{value:t,name:this.name})},onChange(){const{type:t}=this;if(this.isDisabled(t))return this.$emit("overlimit",t);const e="minus"===t?-this.step:+this.step,i=this.format(this.add(+this.currentValue,e));this.emitChange(i),this.$emit(t)},add(t,e){const i=Math.pow(10,10);return Math.round((t+e)*i)/i},clickHandler(t){this.type=t,this.onChange()},longPressStep(){this.clearTimeout(),this.longPressTimer=setTimeout((()=>{this.onChange(),this.longPressStep()}),250)},onTouchStart(t){this.longPress&&(this.clearTimeout(),this.type=t,this.longPressTimer=setTimeout((()=>{this.onChange(),this.longPressStep()}),600))},onTouchEnd(){this.longPress&&this.clearTimeout()},clearTimeout(){clearTimeout(this.longPressTimer),this.longPressTimer=null}}};if(!Array){s.resolveComponent("uv-icon")()}Math;const o=s._export_sfc(n,[["render",function(t,e,i,n,o,u){return s.e({a:t.showMinus&&t.$slots.minus},t.showMinus&&t.$slots.minus?{b:s.o((t=>u.clickHandler("minus"))),c:s.o((t=>u.onTouchStart("minus"))),d:s.o(((...t)=>u.clearTimeout&&u.clearTimeout(...t)))}:t.showMinus?{f:s.p({name:"minus",color:u.isDisabled("minus")?"#c8c9cc":"var(--title-color)",size:"15",bold:!0,customStyle:t.iconStyle}),g:s.o((t=>u.clickHandler("minus"))),h:s.o((t=>u.onTouchStart("minus"))),i:s.o(((...t)=>u.clearTimeout&&u.clearTimeout(...t))),j:u.isDisabled("minus")?1:"",k:s.s(u.buttonStyle("minus"))}:{},{e:t.showMinus,l:t.disabledInput||t.disabled,m:u.getCursorSpacing,n:t.disabled||t.disabledInput?1:"",o:s.o(((...t)=>u.onBlur&&u.onBlur(...t))),p:s.o(((...t)=>u.onFocus&&u.onFocus(...t))),q:s.o([t=>o.currentValue=t.detail.value,(...t)=>u.onInput&&u.onInput(...t)]),r:s.s(u.inputStyle),s:o.currentValue,t:s.t(i.unit),v:t.showPlus&&t.$slots.plus},t.showPlus&&t.$slots.plus?{w:s.o((t=>u.clickHandler("plus"))),x:s.o((t=>u.onTouchStart("plus"))),y:s.o(((...t)=>u.clearTimeout&&u.clearTimeout(...t)))}:t.showPlus?{A:s.p({name:"plus",color:u.isDisabled("plus")?"#c8c9cc":"var(--title-color)",size:"15",bold:!0,customStyle:t.iconStyle}),B:s.o((t=>u.clickHandler("plus"))),C:s.o((t=>u.onTouchStart("plus"))),D:s.o(((...t)=>u.clearTimeout&&u.clearTimeout(...t))),E:u.isDisabled("plus")?1:"",F:s.s(u.buttonStyle("plus"))}:{},{z:t.showPlus})}],["__scopeId","data-v-4a30fd0e"]]);wx.createComponent(o);
