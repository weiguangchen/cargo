"use strict";const t=require("../../../../common/vendor.js"),i=require("../../../uv-ui-tools/libs/mixin/mpMixin.js"),s=require("../../../uv-ui-tools/libs/mixin/mixin.js"),e=require("./props.js"),o={name:"uv-sticky",mixins:[i.mpMixin,s.mixin,e.props],data:()=>({cssSticky:!1,stickyTop:0,elId:"",left:0,width:"auto",height:"auto",fixed:!1}),computed:{style(){const t={};return this.disabled?t.position="static":this.cssSticky?(t.position="sticky",t.zIndex=this.uZindex,t.top=this.$uv.addUnit(this.stickyTop)):t.height=this.fixed?this.height+"px":"auto",t.backgroundColor=this.bgColor,this.$uv.deepMerge(t,this.$uv.addStyle(this.customStyle))},stickyContent(){const t={};return this.cssSticky||(t.position=this.fixed?"fixed":"static",t.top=this.stickyTop+"px",t.left=this.left+"px",t.width="auto"==this.width?"auto":this.width+"px",t.zIndex=this.uZindex),t},uZindex(){return this.zIndex?this.zIndex:970}},created(){this.elId=this.$uv.guid()},mounted(){this.init()},methods:{init(){this.getStickyTop(),this.checkSupportCssSticky(),this.cssSticky||!this.disabled&&this.initObserveContent()},initObserveContent(){this.$uvGetRect("#"+this.elId).then((t=>{this.height=t.height,this.left=t.left,this.width=t.width,this.$nextTick((()=>{this.observeContent()}))}))},observeContent(){this.disconnectObserver("contentObserver");const i=t.index.createIntersectionObserver({thresholds:[.95,.98,1]});i.relativeToViewport({top:-this.stickyTop}),i.observe(`#${this.elId}`,(t=>{this.setFixed(t.boundingClientRect.top)})),this.contentObserver=i},setFixed(t){const i=t<=this.stickyTop;this.fixed=i},disconnectObserver(t){const i=this[t];i&&i.disconnect()},getStickyTop(){this.stickyTop=this.$uv.getPx(this.offsetTop)+this.$uv.getPx(this.customNavHeight)},async checkSupportCssSticky(){"android"===this.$uv.os()&&Number(this.$uv.sys().system)>8&&(this.cssSticky=!0),this.cssSticky=await this.checkComputedStyle(),"ios"===this.$uv.os()&&(this.cssSticky=!0)},checkComputedStyle(){return new Promise((i=>{t.index.createSelectorQuery().in(this).select(".uv-sticky").fields({computedStyle:["position"]}).exec((t=>{i("sticky"===t[0].position)}))}))},checkCssStickyForH5(){}},unmounted(){this.disconnectObserver("contentObserver")}};const n=t._export_sfc(o,[["render",function(i,s,e,o,n,c){return{a:t.s(c.stickyContent),b:n.elId,c:t.s(c.style)}}],["__scopeId","data-v-b87ae031"]]);wx.createComponent(n);
